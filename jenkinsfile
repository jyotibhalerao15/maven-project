pipeline {
    agent any


    stages {
        stage('SCM Checkout'){
           steps {
          git 'https://github.com/jyotibhalerao15/maven-project'
          }
                             }
           
    
        stage ('Compile Stage')
        {
        agent {label 'master-node'}
        

            steps {
                withMaven(maven : 'local-maven') {
                    sh 'mvn clean install'
                                                  }
                  }
                
         }

      stage ('Deploy')
              {
                steps {
                    
 
                      sshagent (credentials: ['f6201e5b-e1ee-49ef-b462-bffc4fd69059']) {
                     sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/pipeline-demo-maven/webapp/target/*.war ec2-user@18.188.198.125:/var/lib/tomcat/webapps'
                    }
                    
                    }
              }
              post {
    success {
      // notify users when the Pipeline fails
      mail to: 'jyoti.bhalerao15@gmail.com',
          subject: "Success Build",
          body: "Finished job successfully"
    }
  }
}
}
